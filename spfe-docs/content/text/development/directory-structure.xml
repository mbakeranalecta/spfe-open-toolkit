<?xml version="1.0" encoding="UTF-8"?>
<!-- This file is part of the SPFE Open Toolkit. See the accompanying license.txt file for applicable licenses.-->
<!-- (c) Copyright Analecta Communications Inc. 2012 All Rights Reserved. -->
<generic-topic xmlns="http://spfeopentoolkit.org/spfe-docs/topic-types/generic-topic"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://spfeopentoolkit.org/spfe-docs/topic-types/generic-topic
    http://spfeopentoolkit.org/spfe-docs/topic-types/generic-topic/schemas/generic-topic.xsd">
    
    <head>
        <id>directory-structure</id>
        <history>
            <revision>
                <date>2012-07-19</date>
                <author>jkeffer</author>
                <comment>New topic</comment>
                <status>In progress</status>
            </revision>
            <revision>
                <date>2012-07-24</date>
                <author>jkeffer</author>
                <comment>New topic</comment>
                <status>Ready for technical review</status>
            </revision>
            <revision>
                <date>2013-11-28</date>
                <author>mbaker</author>
                <comment>Removing reference to output directory. Now hard coded to topic-set-id.</comment>
                <status>In progress</status>
            </revision>
            <revision>
                <date>2014-06-19</date>
                <author>mbaker</author>
                <comment>Updating for new config system</comment>
                <status>In progress</status>
            </revision>
        </history>
        <index>
            <entry>
                <type>feature</type>
                <term>build directory</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>spfebuild</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>synthesis</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>presentation</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>extracted</term>
            </entry>
            <entry>
                <type>file-name</type>
                <term>spfebuild.xml</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>config</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>output</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>topic-sets</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>link-catalogs</term>
            </entry>
            <entry>
                <type>directory-name</type>
                <term>tocs</term>
            </entry>
        </index>
    </head>
    <body>
        <title>Build directory structure</title>
        <p>The SPFE Documentation includes information on the <feature> Open Toolkit</feature> and the <feature>EPPO Simple schema set</feature>. <string-ref id-ref="eppo-simple-topic-set-product"/> <string id="a-string">This is a string</string>: <string-ref id-ref="a-string"/>!</p>
        <fragment-ref id-ref="my-fragment">
            <local-strings>
                <string id="my-local-string"><italic>a local string from the topic file</italic></string>
            </local-strings>
        </fragment-ref>
        <p>The build systems produces a directory structure inside the build directory. Understanding the build directory structure can help you debug problems with the build.</p>
        
        <p>By default, the build directory is named <directory-name>spfebuild</directory-name> and is created in the user's home directory. You can change the location of the build directory by setting the environment variable <code>SPFE_BUILD_DIR</code>.</p>
        
        <p>The build begins by running the configuration script, which creates an ANT build file named <file-name>spfebuild.xml</file-name> at the root of the build directory. This file is created dynamically each time the build is run. Don't try to edit it because it will be overwritten the next time the build is run.</p>
        
        <p>The configuration script also creates a directory for the documentation set being built, which is named using the documentation set id (configured in <config-setting>/spfe/doc-set/doc-set-id</config-setting>). Inside this directory it create a directory named <directory-name>config</directory-name> which contains the consolidated <feature>configuration file</feature>, with the name <file-name>spfe-config.xml</file-name>.</p>
        
        <p>The build script then runs ANT with the <file-name>spfebuild.xml</file-name> build file, to run the rest of the build. The build then creates two additional directories in the doc set directory, <directory-name>build</directory-name>, where all the temporary files used by the build are created, and <directory-name>output</directory-name>, where the output is created.</p>
        
        <p>Inside the <directory-name>build</directory-name> directory, there are three directories, <directory-name>link-catalogs</directory-name>, where the <feature>link catalogs</feature> are created, <directory-name>topic-sets</directory-name>, where the each stage of the topic set build is created, and <directory-name>tocs</directory-name>, where the temporary TOC files are created. The link catalogs and temporary TOCs are created separately from the topic-set files because they are used by all topic set builds.</p>
        
        <p>Inside the <directory-name>topic-sets</directory-name> directory, a directory is created for each topic set in the build, with its name matching the <config-setting xpath="/spfe/topic-set/topic-set-id">topic-set-id</config-setting> of each topic set.</p>
        
        <p>Inside each of these topic set directories, the following files and directories are created:</p>
        
        <ul>
            <li>
                <p>A generated script file for each stage of the build: extract, synthesis, presentation, etc.</p>
            </li>
            <li>
                <p>A build flag for each stage of the build. </p>
            </li>
            <li>
                <p>A <directory-name>extracted</directory-name> directory containing the temp files for the <feature>extract</feature> stage (if there is an extraction stage for this topic set).</p>
            </li>
            <li>
                <p>A <directory-name>synthesis</directory-name> directory containing the temp files for the <feature>synthesis</feature> stage.</p>
            </li>
            <li>
                <p>A <directory-name>presentation</directory-name> directory containing the temp files for the <feature>presentation</feature> stage.</p>
            </li>
            <li>
                <p>The <file-name>image-list.txt</file-name> file, which is used to copy image files used in the topic set to the output directory.</p>
            </li>
            
        </ul>
    </body>
    
</generic-topic>